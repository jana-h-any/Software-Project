<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Add Menu Item</title>
<link rel="stylesheet" href="style.css">
<style>
form { display:flex; flex-direction:column; width:400px; gap:15px; }
input, select, textarea { padding:12px; border-radius:10px; border:none; background:#2c2c2c; color:white; }
button { padding:12px; border-radius:20px; background:#f0b133; color:#1c1c1c; font-weight:bold; cursor:pointer; }
button:hover { background:#d35400; color:white; }
#itemImage {display: none;}
.custom-file-upload {  padding:12px; border-radius:10px; background: #2c2c2c; color: #7b7676; font-weight: normal;cursor: pointer;text-align: left;}
.custom-file-upload:hover {  background: #3a3a3a; color: aliceblue;}
</style>
</head>
<body >

    <header>
        <div class="logo">BTWEETY</div>
        <nav>
            <ul>
                <li><a href="restaurantDashboard.html">ORDERS</a></li>
                <li><a href="addItem.html">ADD ITEM</a></li>
                <li>
                    <a class="logout-icon" id="logoutBtn" href="#">
                        <img src="assets/icons/wexit.png" alt="Logout">
                    </a>
                </li>
            </ul>
        </nav>
    </header>
    <CENTER>
<h2>Add Menu Item</h2>
<form id="addMenuForm">
    <input type="text" id="itemName" placeholder="Item Name" required>
    <input type="number" step="1" id="itemPrice" placeholder="Price (+ve)" required min="0">
    <label class="custom-file-upload">
    <input type="file" id="itemImage" accept="image/*" >
    <span id="fileText">Choose file</span>
    </label>
    <input  type="text" id="itemCategory" placeholder="Category "required>
    <textarea id="itemDescription" placeholder="Description (optional)"></textarea>
    <button type="submit">Add Item</button>
</form>
</CENTER>

<script>
const restaurantId = localStorage.getItem('restaurantId');
if(!restaurantId) window.location.href='restaurant-login.html';

const fileInput = document.getElementById('itemImage');
const fileLabel = document.querySelector('.custom-file-upload');

const fileText = document.getElementById('fileText');

fileInput.addEventListener('change', () => {
    fileText.textContent = fileInput.files[0]?.name || "Choose file";
});


const addMenuForm = document.getElementById('addMenuForm');
addMenuForm.addEventListener('submit', async e => {
    e.preventDefault();

    const price = parseFloat(document.getElementById('itemPrice').value);
    if(price <= 0){
        alert("Price must be positive");
        return;
    }

    const imageFile = fileInput.files[0];
    if(!imageFile){
        alert("Please choose an image");
        return;
    }

    const formData = new FormData();
    formData.append("restaurantId", restaurantId);
    formData.append("name", document.getElementById('itemName').value);
    formData.append("price", price);
    formData.append("category", document.getElementById('itemCategory').value);
    formData.append("description", document.getElementById('itemDescription').value);
    formData.append("image", imageFile);

    try {
        const res = await fetch('http://localhost:3000/restaurant/add-menu-item', {
            method: 'POST',
            body: formData
        });

        const data = await res.json();
        if(data.success){
            alert("Item added successfully!");
            addMenuForm.reset();
            fileText.textContent = "Choose file";
        } else {
            alert(data.message || "Error adding item");
        }

    } catch(err){
        alert('error!!!');
        console.error(err);
    }
});

document.getElementById('logoutBtn').addEventListener('click', ()=>{
    localStorage.removeItem('restaurantId');
    window.location.href = 'restaurant-login.html';
});
</script>

</body>
</html>
